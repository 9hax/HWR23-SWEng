{% set title = lang["home"] %} {% extends "master.html" %} {% block body %}
<div class="demo-graphs mdl-shadow--2dp mdl-color--white mdl-cell mdl-cell--8-col"  style="width:100%;">
    <p>
        <h5>Behörde suchen:</h5>
        <div class="mdl-textfield mdl-js-textfield" style="width: 100%; display: flex; align-items: center;">
                <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" >
                    <i class="material-icons search">search</i>
                </button>
                <input class="mdl-textfield__input mdl-shadow--2dp" type="search" id="searchBar" placeholder="{{lang['department-search']}}" name="searchBar" style="border: 2px solid #0000; border-radius: 5px; outline: none; color: #9DBFAF; margin-left: 9%;padding-top:1%;padding-bottom:0;">
        </div>
        <div id="options"style="border: 1px solid #606D74;display:none;margin-left: 9%">
            <ul class="demo-list-item mdl-list" id="officeOptionsUL" name="officeOptionsUL" style:"align-items:center; padding-bottom:0;padding-top:0;">
                {%for data in officeData%}
                    <li class="mdl-list__item" style="padding-bottom:0;padding-top:0;">
                        <span class="mdl-list__item-primary-content" style="padding-bottom:0;padding-top:0;">
                            <a class="option" id="office{{data["username"]}}" href="/office/{{data["username"] | replace(' ', '') | lower }}" style="padding-right: 10%;padding-left: 10%; padding-bottom: 1%;padding-top: 1%;text-decoration: none; display: block;text-align:center;margin:auto;  " onmouseover="this.style.backgroundColor='#DCDFE1';" onmouseout="this.style.backgroundColor='';">{{data["officeName"]}}</a>
                        </span>
                    </li>
                {%endfor%}
        </div>
    </p>
</div>
<div class="demo-graphs mdl-shadow--2dp mdl-color--white mdl-cell mdl-cell--8-col" style="width:100%;">
    <div class="mdl-cell mdl-cell--12-col">
        <h5>Meine Dokumente</h5> 
        <ul class="mdl-list mdl-shadow--2dp">
            {% for document in documents %}
                <li class="mdl-list__item">
                    <span class="mdl-list__item-primary-content">
                        <a href="{{ url_for('download_document', document_id=document.id) }}">{{ document.title }}</a>
                    </span>
                    <span class="mdl-list__item-secondary-content">
                        <span>{{ document.created_by.fullname }}</span>
                        <a href="{{ url_for('delete_document', document_id=document.id) }}" class="delete-icon">Löschen</a>
                    </span>
                </li>
            {% endfor %}
        </ul>
    </div>
</div>

<script>
    var div = document.getElementById("options")
    var input = document.getElementById('searchBar');

    window.onkeydown = function(e){
        var filter, ul, li, i, txtValue,a;
        a = document.getElementsByClassName("option");
        filter = input.value.toUpperCase();
        
        if ( e.target.id  == "searchBar"){
            li = document.getElementsByClassName("mdl-list__item");
            for (i = 0; i < li.length; i++) {
                txtValue = a[i].textContent || a[i].innerText;
                    
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    div.style.display="block"
                    li[i].style.visibility = 'visible';
                    li[i].style.display = "block";
                } else {
                    li[i].style.display = "none";
                }
            }
        }
    }
    window.onclick = function(e){
        if ( e.target.id  != "searchBar"){
            div.style.display="none"
        }
    }

    const downloadLink = document.getElementsByClassName("downloadLink")[];
    for (var i=0 ; i<=downloadLink.length; ++i ) {
        const base64String = downloadLink[i].href
        if(base64String.includes("data")){
            const base64WithoutPrefix = base64String.replace(/^data:application\/(pdf|png|txt|jpeg|jpg);base64,/, "");

            const binaryData = atob(base64WithoutPrefix);

            const arrayBuffer = new ArrayBuffer(binaryData.length);
            const uint8Array = new Uint8Array(arrayBuffer);
            for (let i = 0; i < binaryData.length; i++) {
                uint8Array[i] = binaryData.charCodeAt(i);
            }

            const blob = new Blob([uint8Array]);
            const objectURL = URL.createObjectURL(blob);
            downloadLink.href = objectURL;
            URL.revokeObjectURL(objectURL);
        }
    }   
</script>
{% endblock %}
